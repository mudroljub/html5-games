<!doctype html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <title>Skupština</title>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            border: 0;
            cursor: crosshair;
        }

    </style>
</head>
<body>

    <canvas id="platno"></canvas>

    <script>

        // napraviti posebnu funkciju koja ucitava sve slike, nakon cega poziva postaviScenu()


        "use strict";
        window.$ = function(selector) {
            return document.querySelector(selector);
        };


        /*************** VARIJABLE ***************/
        var BAZICNA_SIRINA = 1280;      // ekrana
        var BRZINA_IGRICE = 1500;        // veci broj je sporije
        var poeni = 0;
        var vreme_igre = 50;
        var slucajna_pozicija;
        var slucajX;
        var slucajY;
        var misX;
        var misY;

        var platno = $('#platno')
        platno.width = window.innerWidth
        platno.height = window.innerHeight

        var sadrzaj = platno.getContext('2d')
        sadrzaj.font = "30px Verdana";
        sadrzaj.fillStyle = "white";
        sadrzaj.strokeStyle = 'black';

        var slike = {
            skupstina: 'slike/skupstina.png',
            vulin: 'slike/vulin.png',
            politicar: 'slike/politicar.png'
        }

        
        var nova_visina_pozadine = (window.innerWidth / skupstina.width) * skupstina.height

        var pozicije_prozora = [
            [window.innerWidth/5.9, nova_visina_pozadine/4],             // prvi prozor
            [window.innerWidth/2.2, nova_visina_pozadine/4],
            [window.innerWidth/1.35, nova_visina_pozadine/4],
            [window.innerWidth/5.9, nova_visina_pozadine/1.55],
            [window.innerWidth/2.2, nova_visina_pozadine/1.55],
            [window.innerWidth/1.35, nova_visina_pozadine/1.55]
        ]

        var politicar = {
            color: "#00A",
            x: 220,
            y: 270,
            sirina: 32,
            visina: 32,
            
            crtaj: function(slika, x, y, sirina, visina) {
                sadrzaj.drawImage(slika, x, y, sirina, visina);
            } // kraj crtaj
        };


        /*************** POZIVI ***************/

        // prosledjuje niz ova_slika i poziva povratnu funkciju (iscrtava) kada se sve ucitaju
        ucitajSlike(slike, function(slike) {
            sadrzaj.drawImage(skupstina, 0, 0, window.innerWidth, nova_visina_pozadine);
            sadrzaj.drawImage(politicar, 100, 30, 200, 137);
            sadrzaj.drawImage(vulin, 350, 55, 93, 104);
        });

        postaviScenu();
        var animacija = setInterval(azuriraj, BRZINA_IGRICE);



        /*************** SLUSACI ***************/

        platno.addEventListener('click', function(event){
            misX = event.clientX;
            misY = event.clientY;

            if( (misX > slucajX && misX < slucajX + vulin.width) && (misY > slucajY && misY < slucajY + vulin.height) ){
                sadrzaj.fillText("Jaooj!", misX, misY);
                poeni++;
            }
        })



        /*************** FUNKCIJE ***************/

        function postaviScenu() {
            prikaziPoene()
        }


        function azuriraj(){
            sadrzaj.drawImage(skupstina, 0, 0, window.innerWidth, nova_visina_pozadine);
            prikaziPoene();

            slucajna_pozicija = Math.floor(Math.random() * 6);
            slucajX = pozicije_prozora[slucajna_pozicija][0];
            slucajY = pozicije_prozora[slucajna_pozicija][1];
            
            politicar.crtaj( bezlicni_politicar, slucajX, slucajY, prilagodiSirinu(bezlicni_politicar), prilagodiVisinu(bezlicni_politicar) );

            if(vreme_igre < 1) {
                clearInterval(animacija);
                sadrzaj.fillRect(window.innerWidth/2 - window.innerWidth/4, window.innerHeight/2 - window.innerHeight/4, window.innerWidth/2, window.innerHeight/2);
                sadrzaj.fillStyle="#000";
                sadrzaj.font = "48px Verdana";
                sadrzaj.fillText("Igra je završena!", window.innerWidth/2 - window.innerWidth/4 + 100, window.innerHeight/2 - window.innerHeight/4 + 100);
            }

            vreme_igre--;
        }


        function ucitajSlike(slike, callback) {
            var brojSlika = Object.keys(slike).length;
            var ucitaneSlike = 0;

            for(var ova_slika in slike) {

                // pravi globalnu varijablu sa nazivom slike !
                window[ova_slika] = new Image();

                // kada ucita ovu sliku, ako su ostale ucitane, poziva povratnu funkciju
                window[ova_slika].onload = function() {
                    ucitaneSlike++;
                    if(ucitaneSlike >= brojSlika) {
                        callback(window);
                    }
                };
                // daje izvor slici
                window[ova_slika].src = slike[ova_slika];
            }
        }


        function prikaziPoene(){
            sadrzaj.fillStyle="#000";
            sadrzaj.fillRect(20,80,180,100);
            sadrzaj.stroke();
            sadrzaj.fillStyle="#FFF";
            sadrzaj.font = "24px Verdana";
            sadrzaj.fillText("Poeni: " + poeni, 30, 120);
            sadrzaj.fillText("Vreme: " + vreme_igre“‘, 30, 160);
        }


        // prilagodjava sliku za razne ekrane, ne popravlja pogresnu velicinu slike!
        function prilagodiSirinu(slika){
            return slika.width * (innerWidth/BAZICNA_SIRINA)
        }

        function prilagodiVisinu(slika) {
            return slika.height * (innerWidth/BAZICNA_SIRINA)
        }



    </script>

</body>
</html>